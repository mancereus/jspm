<!doctype html>
<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-styles/paper-styles.html">
<link rel="import" href="../../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">

<dom-module id="board-game-container">

    <template>
         <style>
        :host {
            cursor: pointer;
            padding: 4px;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        #tmpl {
            display: flex;
            justify-content: space-around;
            align-content: space-between;
        }
    </style>
    <paper-card heading="{{container}}" container="{{container}}">
         <div class="card-content">
            <template is="dom-repeat" id="tmpl">
                <div on-track="trackElement" draggable="true">
                <iron-icon icon="home"></iron-icon>{{item.key}}</div>
            </template>
      </div>
      <div class="card-actions">
            <iron-icon icon="refresh" on-tap="reroll"></iron-icon>
        </div>
        </paper-card>
    </template>

    <script>
        Polymer({
                is: 'board-game-container',
                properties: {
                    container: {
                        type: String,
                        value: "stack"
                    },
                    data: {
                        type: Array,
                        value: function () { return []; }
                    }
                            },
                     observers: [
                        'refresh(data.*)'
                    ],
                   ready: function (e) {
                       var template = Polymer.dom(this).querySelector('template');
                       if(template) {
                           this.templatize(template);
                       }
                   },
                   attached: function (e) {
                       this.$.tmpl.set('items',this.data[this.container]);
                   },
                   getItems: function (e) {
                       return this.data[this.container];
                   },
                   refresh: function (e) {
                        this.$.tmpl.render();
                   },
                   _getContainer: function (el) {
                        if (el.hasAttribute('container'))
                            return el.getAttribute('container');
                        while (el.parentElement) {
                            el = el.parentElement;
                            if (el.hasAttribute('container'))
                                return el.getAttribute('container');
                        }
                       return null;
                   },
                   trackElement: function (e) {
                        switch (e.detail.state) {
                            case 'start':
                                console.log('Tracking started!');
                                break;
                            case 'track':
                                console.log('Tracking in progress... ' +
                                    e.detail.x + ', ' + e.detail.y);
                                break;
                            case 'end':
                                console.log(e.model.item);
                                var container = this._getContainer(e.detail.hover());
                                var srccontainer = this.container;
                                if (container == srccontainer) {
                                    var removearr = this.splice('data.' + srccontainer, e.model.index, 1);
                                    this.push('data.' + container, removearr[0]);

                                }
                                else {
                                    this.push('data.' + container, e.model.item);
                                    this.splice('data.' + srccontainer, e.model.index, 1);
                                }
                                break;
                    }
                },
            });
    </script>

</dom-module>