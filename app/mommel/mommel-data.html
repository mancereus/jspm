<link rel="import" href="../../bower_components/polymer/polymer.html">
<script src="data.js"></script>

<dom-module id="mommel-data">
  <template>
  </template>
  <script>
    function get(name) {
      if (name = new RegExp('[?&]' + encodeURIComponent(name) + '=([^&]*)').exec(location.search))
        return decodeURIComponent(name[1]);
    }

    Polymer({
      is: 'mommel-data',
      properties: {
        mommeldata: {
          type: Object,
          value: {}
        },
        categories: {
          type: Array,
          value: getData()
        },
        konsonant: {
          type: String,
          computed: 'getKons(kons)'
        },
        vokal: {
          type: String,
          computed: 'getVok(vok)'
        }
      },
      getKons: function () {
        if(this.kons == undefined)
          return "c";
        var idx = Math.floor(Math.random() * this.kons.length);
        var res = this.kons.slice(idx, idx + 1);
        this.kons = this.kons.slice(0, idx) + this.kons.slice(idx + 1, this.kons.length);
        return res;
      },
      getVok: function () {
        if(this.vok == undefined)
          return "a";
        var idx = Math.floor(Math.random() * this.vok.length);
        var res = this.vok.slice(idx, idx + 1);
        this.vok = this.vok.slice(0, idx) + this.vok.slice(idx + 1, this.vok.length);
        return res;
      },
      count: function () {
        if (this.kons == undefined)
          return 0;
        return this.kons.length + this.vok.length;
      },
      attached: function() {
		      console.log(this.mommeldata);
      },
      ready: function () {
        var k = get('kons');
        if (k != undefined) {
          this.mommeldata.kons = k;
        }
        else {
          this.mommeldata.kons = 'NNNNNNSSSSSRRRRRTTTTDDDDHHHLLLCCGGMMBBWWFKZPVJYXQ';
        }
        ;
        var v = get('vok');
        if (v != undefined) {
          this.mommeldata.vok = v;
        }
        else {
          this.mommeldata.vok = 'EEEEEEEIIIIIIAAAAAUUUOO\xC4\xD6\xDC';
        }
        ;
        var idx = Math.floor(Math.random() * this.categories.length);
        this.mommeldata.category = this.categories[idx].name;
        this.mommeldata.getKons = this.getKons;
        this.mommeldata.getVok = this.getVok;
      }
    });
  </script>
</dom-module>